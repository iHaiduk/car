// Generated by CoffeeScript 1.8.0
(function() {
  var currentInfo, globalGetreloadModels, infoModels, infoObject, nospace, reloadModels, setInfo;

  infoObject = {};

  reloadModels = function(yearSlide) {
    var globalGetreloadModels, make, selected_models, year, _selected_models;
    make = ($("#selected_make").val() === "" ? 0 : $("#selected_make").val());
    year = yearSlide.slider("getValue");
    selected_models = $(document).find("#selected_models");
    _selected_models = selected_models[0].selectize;
    if (typeof globalGetreloadModels !== "undefined" && globalGetreloadModels !== null) {
      globalGetreloadModels.abort();
    }
    globalGetreloadModels = $.get("/get/models/" + make + "/" + year + "/", function(data) {
      _selected_models.clearOptions();
      _selected_models.load(function(callback) {
        callback(data);
      });
    });
  };

  nospace = function(str) {
    return str.replace(/\s+/g, '');
  };

  currentInfo = function(id) {
    var inf, val, _results;
    _results = [];
    for (inf in infoObject) {
      val = infoObject[inf];
      if (parseInt(id) === val.id) {
        _results.push(val);
      } else {
        continue;
      }
    }
    return _results;
  };

  setInfo = function(info) {
    $("#model_transmission_type").val(info.model_transmission_type);
    $("#model_body").val(info.model_body);
    $("#region").val(info.region);
    $("#country").val(info.country);
    $("#model_drive").val(info.model_drive);
    $("#model_engine_type").val(info.model_engine_type);
    $("#model_engine_position").val(info.model_engine_position);
    $("#model_engine_cyl").val(info.model_engine_cyl);
    $("#model_engine_cc").val(info.model_engine_cc);
    $("#model_engine_valves_per_cyl").val(info.model_engine_valves_per_cyl);
    $("#model_engine_ci").val(info.model_engine_ci);
    $("#model_engine_torque_rpm").val(info.model_engine_torque_rpm);
    $("#model_engine_fuel").val(info.model_engine_fuel);
    $("#model_lkm_hwy").val(info.model_lkm_hwy);
    $("#model_lkm_city").val(info.model_lkm_city);
    $("#model_fuel_cap_l").val(info.model_fuel_cap_l);
    $("#model_length_mm").val(info.model_length_mm);
    $("#model_width_mm").val(info.model_width_mm);
    $("#model_height_mm").val(info.model_height_mm);
    return $("#model_weight_kg").val(info.model_weight_kg);
  };

  infoModels = function(id, yearSlide) {
    "use strict";
    var selected_models_trim, type;
    type = "";
    selected_models_trim = $("#selected_models_trim")[0].selectize;
    if ($.isNumeric(id)) {
      type = "id";
    } else {
      type = "name";
    }
    $.get("/get/info/models/" + type + "/" + id + "/" + yearSlide.slider("getValue"), function(data) {
      var lngth;
      lngth = data.length;
      if (lngth) {
        if (lngth === 1) {
          setInfo(data[0]);
        }
        infoObject = data;
        selected_models_trim.clearOptions();
        selected_models_trim.load(function(callback) {
          callback(data);
        });
      }
    });
  };

  globalGetreloadModels = null;

  $(document).ready(function() {
    var firstLit, make_select, socket, vinId, vinSend, yearSlide;
    vinSend = $("#vinSend");
    vinId = $("#vinId");
    yearSlide = $(".slider").slider();
    make_select = $(".make_select");
    firstLit = null;
    vinId.on("keyup focusout", function() {
      var alNumRegex, text, _this;
      _this = $(this);
      text = nospace(_this.val());
      console.log(text);
      _this.val(text.slice(0, 18));
      alNumRegex = /^([a-zA-Z0-9]+)$/;
      $(this).parent().removeClass("has-success has-error");
      vinSend.removeClass("btn-danger btn-success").find("i").removeClass("fa-check fa-times");
      if (text.length === 17 && alNumRegex.test(text)) {
        $(this).parent().addClass("has-success");
        vinSend.addClass("btn-success").find("i").addClass("fa-check");
      } else {
        $(this).parent().addClass("has-error");
        vinSend.addClass("btn-danger").find("i").addClass("fa-times");
      }
    });
    vinSend.on("click", function() {
      if ($(this).hasClass("btn-success")) {
        return $.ajax({
          url: "/get/vin",
          type: "GET",
          data: {
            vin: vinId.val()
          },
          dataType: "json",
          success: function(data) {
            return console.log(data);
          }
        });
      }
    });
    yearSlide.on("slideStop", function() {
      $("#settings_year h6").text(yearSlide.slider("getValue"));
      reloadModels(yearSlide);
    }).on("slide", function() {
      $("#settings_year h6").text(yearSlide.slider("getValue"));
    });
    $.get("/get/makes/", function(data) {
      $("#selected_make").selectize({
        options: data,
        labelField: "name",
        valueField: "id",
        maxItems: 1,
        sortField: "name",
        searchField: "name",
        persist: false,
        create: function(input) {
          return {
            name: input,
            id: input
          };
        },
        onChange: function() {
          reloadModels(yearSlide);
        },
        render: {
          option: function(data, escape) {
            var make, text;
            make = escape(data.name);
            text = "";
            if (firstLit !== make[0].toUpperCase()) {
              if (firstLit != null) {
                text += "</div>";
              }
              text += "<div data-value=\"\" data-selectable=\"false\" data-group=\"" + make[0] + "\" class=\"optgroup\">" + "<div class=\"optgroup-header\">" + make[0] + "</div>";
              firstLit = make[0].toUpperCase();
            }
            text += "<div data-value=\"" + escape(data.id) + "\" data-selectable=\"\" class=\"active-result group-option\">" + make.charAt(0).toUpperCase() + make.substr(1) + "</div>";
            return text;
          },
          item: function(data, escape) {
            return "<span class=\"tag label label-info\">" + escape(data.name) + "</span>";
          }
        }
      });
    });
    $("#selected_models").selectize({
      labelField: "name",
      valueField: "id",
      maxItems: 1,
      sortField: "name",
      searchField: "name",
      render: {
        option: function(data, escape) {
          var make, text;
          make = escape(data.name);
          text = "<div data-value=\"" + escape(data.id) + "\" data-selectable=\"\" class=\"active-result group-option\">" + make.charAt(0).toUpperCase() + make.substr(1) + "</div>";
          return text;
        },
        item: function(data, escape) {
          return "<span class=\"tag label label-info\">" + escape(data.name) + "</span>";
        }
      },
      persist: true,
      hideSelected: true,
      onChange: function(input) {
        "use strict";
        infoModels(input, yearSlide);
      },
      create: function(input) {
        return {
          name: input,
          id: input
        };
      }
    });
    $("#selected_models_trim").selectize({
      labelField: "model_trim",
      valueField: "id",
      maxItems: 1,
      sortField: "model_trim",
      searchField: "model_trim",
      persist: true,
      hideSelected: true,
      onChange: function(input) {
        "use strict";
        var info;
        info = currentInfo(input)[0];
        if (info != null) {
          setInfo(info);
        }
        console.log($('#paramModelForm').serializeJSON());
      }
    });
    $("#model_transmission_type").selectize({
      maxItems: 1,
      valueField: "key",
      labelField: "title",
      searchField: "title",
      sortField: "title",
      options: kpp,
      create: false,
      persist: true,
      hideSelected: true,
      create: function(input) {
        return {
          title: input,
          key: input
        };
      }
    });
    $("#model_body").selectize({
      maxItems: 1,
      valueField: "key",
      labelField: "title",
      searchField: "title",
      sortField: "title",
      options: model_body,
      create: false,
      persist: true,
      hideSelected: true,
      create: function(input) {
        return {
          title: input,
          key: input
        };
      }
    });
    $("#profileForm").bootstrapValidator({
      feedbackIcons: {
        valid: "glyphicon glyphicon-ok",
        invalid: "glyphicon glyphicon-remove",
        validating: "glyphicon glyphicon-refresh"
      },
      fields: {
        email: {
          validators: {
            notEmpty: {
              message: "The email address is required"
            },
            emailAddress: {
              message: "The email address is not valid"
            }
          }
        },
        password: {
          validators: {
            notEmpty: {
              message: "The password is required"
            }
          }
        }
      }
    });
    return;
    socket = io.connect("http://localhost");
    socket.on("news", function(data) {
      console.log(data);
      return socket.emit("my other event", {
        my: "data"
      });
    });
  });

}).call(this);
